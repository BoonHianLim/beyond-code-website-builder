import unittest
from src.services.omni_parser import Omniparser
import base64

class TestParser(unittest.TestCase):
    def __init__(self, *args, **kwargs):
        super(TestParser, self).__init__(*args, **kwargs)
        
    def test_parse(self):
        omniparser = Omniparser()
        with open('./src/tests/fixtures/sketch-1.png', 'rb') as f:
            image_base64 = base64.b64encode(f.read()).decode()
            _, parsed_content_list = omniparser.parse(image_base64)
            self.assertEqual(parsed_content_list, [{'type': 'text', 'bbox': [0.11772666126489639, 0.09335219115018845, 0.16779431700706482, 0.12376237660646439], 'interactivity': False, 'content': 'logo', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.33829498291015625, 0.09193776547908783, 0.3951285481452942, 0.11315417289733887], 'interactivity': False, 'content': '#ome', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.42760488390922546, 0.09335219115018845, 0.4898511469364166, 0.1159830242395401], 'interactivity': False, 'content': 'About', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.26657646894454956, 0.20792078971862793, 0.3640054166316986, 0.24752475321292877], 'interactivity': False, 'content': 'Book', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.37212449312210083, 0.2135785073041916, 0.42760488390922546, 0.24752475321292877], 'interactivity': False, 'content': 'an', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.4303112328052521, 0.1958981603384018, 0.6928281188011169, 0.26379066705703735], 'interactivity': False, 'content': 'appointment', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.3024357259273529, 0.2567185163497925, 0.6420838832855225, 0.2871287167072296], 'interactivity': False, 'content': "We'll respond in 3-5 business days", 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.22327469289302826, 0.35360679030418396, 0.2855209708213806, 0.37057992815971375], 'interactivity': False, 'content': 'name:', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.21380244195461273, 0.42574256658554077, 0.30175912380218506, 0.448373407125473], 'interactivity': False, 'content': 'address:', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.21515561640262604, 0.49787837266921997, 0.2902570962905884, 0.5325317978858948], 'interactivity': False, 'content': 'phone:', 'source': 'box_ocr_content_ocr'}, {
                             'type': 'text', 'bbox': [0.14479026198387146, 0.5799151062965393, 0.32002705335617065, 0.6145685911178589], 'interactivity': False, 'content': 'date with picker:', 'source': 'box_ocr_content_ocr'}, {'type': 'text', 'bbox': [0.17861975729465485, 0.6598302721977234, 0.2889039218425751, 0.6874116063117981], 'interactivity': False, 'content': 'comments:', 'source': 'box_ocr_content_ocr'}, {'type': 'icon', 'bbox': [0.7590480446815491, 0.08844930678606033, 0.8792089223861694, 0.13181565701961517], 'interactivity': True, 'content': 'login ', 'source': 'box_yolo_content_ocr'}, {'type': 'icon', 'bbox': [0.3354102075099945, 0.8045525550842285, 0.5936758518218994, 0.8708345890045166], 'interactivity': True, 'content': 'Submit ', 'source': 'box_yolo_content_ocr'}, {'type': 'icon', 'bbox': [0.503908097743988, 0.0898977667093277, 0.5883210897445679, 0.11782992631196976], 'interactivity': True, 'content': 'Contact ', 'source': 'box_yolo_content_ocr'}, {'type': 'icon', 'bbox': [0.3371889293193817, 0.6567633748054504, 0.6065463423728943, 0.7636141180992126], 'interactivity': True, 'content': 'a checkbox.', 'source': 'box_yolo_content_yolo'}, {'type': 'icon', 'bbox': [0.34006795287132263, 0.3368590772151947, 0.6110578775405884, 0.3912198543548584], 'interactivity': True, 'content': 'A checkbox for selecting a color.', 'source': 'box_yolo_content_yolo'}, {'type': 'icon', 'bbox': [0.33876854181289673, 0.4132099151611328, 0.6093929409980774, 0.4665846824645996], 'interactivity': True, 'content': 'a checkbox.', 'source': 'box_yolo_content_yolo'}, {'type': 'icon', 'bbox': [0.3328661024570465, 0.5744287967681885, 0.604232907295227, 0.628367006778717], 'interactivity': True, 'content': 'A checkbox for selecting a color.', 'source': 'box_yolo_content_yolo'}, {'type': 'icon', 'bbox': [0.33842724561691284, 0.49107906222343445, 0.6069254875183105, 0.5460434556007385], 'interactivity': True, 'content': 'Maximize window.', 'source': 'box_yolo_content_yolo'}])
